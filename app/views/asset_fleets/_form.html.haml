= simple_form_for(@asset_fleet,
:html => {:class => 'form-vertical asset_fleet_form'},
:wrapper => :vertical_form,
:wrapper_mappings => {:check_boxes => :vertical_radio_and_checkboxes, :radio_buttons => :vertical_radio_and_checkboxes, :file => :vertical_file_input, :boolean => :vertical_boolean}) do |f|

  = f.association :organization, :collection => TransitOperator.where(id: @organization_list), :label_method => 'coded_name'
  = f.association :asset_fleet_type, :collection => AssetFleetType.active, :disabled => !@asset_fleet.new_record?
  = f.input :ntd_id, :required => !@asset_fleet.new_record?
  = f.input :agency_fleet_id
  = f.input :fleet_name
  = f.input :notes, :label => 'NTD Notes', :placeholder => 'Notes will appear in generated NTD report.'

  - unless @asset_fleet.new_record?
    #assets.well.well-sm
      %label.control-label
        %i.fa.fa-bus.fa-1-5x
        Assets
      .links.pull-right
        = link_to_add_association f, :assets, :class => 'btn btn-xs btn-info', data: {association_insertion_method: 'after'} do
          %i.fa.fa-plus
      %label#assets-error.error
      = f.simple_fields_for :assets do |asset|
        = render 'asset_fields', f: asset

  = f.button :submit, :class => "btn btn-primary"

:javascript
  var typeahead_field_line;

  $(document).ready(function() {
    $('#asset_fleet_asset_fleet_type_id').change();
  });

  $('.asset_fleet_form').validate({
    submitHandler: function(form) {
      form.submit();
    }
  });

  $('#asset_fleet_asset_fleet_type_id').on('change', function() {
    var val = $(this).val();
    if (parseInt(val) == parseInt('#{AssetFleetType.find_by(class_name: "Vehicle").id}')) {
      $('label[for="asset_fleet_ntd_id"]').html('#{AssetFleet.new(asset_fleet_type: AssetFleetType.find_by(class_name: "Vehicle")).ntd_id_label}');
      $('.asset_fleet_ntd_id').show();
      $('.asset_fleet_fleet_name').hide();
    } else if (parseInt(val) == parseInt('#{AssetFleetType.find_by(class_name: "SupportVehicle").id}')) {
      $('label[for="asset_fleet_ntd_id"]').html('#{AssetFleet.new(asset_fleet_type: AssetFleetType.find_by(class_name: "SupportVehicle")).ntd_id_label}');
      $('.asset_fleet_ntd_id').show();
      $('.asset_fleet_fleet_name').show();
    } else {
      $('.asset_fleet_ntd_id').hide();
      $('.asset_fleet_fleet_name').hide();
    }
  });

  $('#assets').on('cocoon:after-insert', function(e, added_purchase) {
    $('.asset_search_text').on('focus', function() {
      nested_id = $(this).attr('id');
      typeahead_field_line = '#'+nested_id.substr(0,nested_id.length-17);
      _typeahead_source_url = $(this).data('url');
    });

    // Enable typeahead for the SMO filter
    $('.asset_search_text').typeahead({
      items: 10,
      minLength: 2,
      source: _typeahead_searcher,
      matcher: _typeahead_matcher,
      highlighter: _typeahead_highlighter,
      updater: function (obj) {
        var item = JSON.parse(obj);
        // Update the UI
        $(typeahead_field_line+'asset_search_text').attr('value', item.name);
        $(typeahead_field_line+'object_key').val(item.id);
        return item.name;
      }
    });
  });